name: Keep Render Server Alive

on:
  schedule:
    # Run every 10 minutes
    - cron: '*/10 * * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  ping-server:
    runs-on: ubuntu-latest
    
    steps:
      - name: Ping Backend Health Endpoint
        run: |
          echo "Pinging server at $(date)"
          
          RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" \
            --max-time 30 \
            ${{ secrets.BACKEND_URL }}/health)
          
          echo "Response code: $RESPONSE"
          
          if [ $RESPONSE -eq 200 ]; then
            echo "✓ Server is alive"
          else
            echo "⚠ Server returned unexpected status: $RESPONSE"
            exit 1
          fi
      
      - name: Log Success
        if: success()
        run: echo "Keep-alive ping successful at $(date)"
      
      - name: Log Failure
        if: failure()
        run: echo "Keep-alive ping failed at $(date)"